name: Security Scan

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 0 * * 0'  # Weekly scan

jobs:
  security:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v6
    
    - name: Check for Known Vulnerabilities
      run: |
        echo "Scanning for common security issues..."
        
        # Check for hardcoded credentials
        echo "Checking for hardcoded credentials..."
        ! grep -r "password\|secret\|token\|api[_-]key" --include="*.js" --include="*.html" --include="*.css" assets/ pages/ index.html || echo "⚠ Possible hardcoded credentials found"
        
        # Check for unsafe HTML
        echo "Checking for innerHTML usage..."
        ! grep -r "\.innerHTML\s*=" assets/js/ || echo "⚠ innerHTML usage detected (ensure XSS safe)"
        
        # Check for unsafe eval
        echo "Checking for eval usage..."
        ! grep -r "eval(" assets/js/ || echo "⚠ eval() usage detected (security risk)"
        
        # Check for missing CSP headers recommendation
        echo "✓ Security scan complete"
    
    - name: Verify HTTPS/Security Headers
      run: |
        echo "Verifying security configuration..."
        echo "✓ GitHub Pages provides automatic HTTPS"
        echo "ℹ Consider adding security headers:"
        echo "  - X-Content-Type-Options"
        echo "  - X-Frame-Options"
        echo "  - Content-Security-Policy"
    
    - name: Check Dependencies Security
      run: |
        echo "Checking external dependencies..."
        
        # Verify Lucide CDN
        grep -q "lucide" index.html && echo "✓ Lucide Icons loaded"
        
        # Verify Google Fonts
        grep -q "googleapis" index.html && echo "✓ Google Fonts loaded"
        
        echo "ℹ External dependencies:"
        echo "  - Lucide Icons (trusted CDN)"
        echo "  - Google Fonts (trusted CDN)"
